<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr Stevie Pederson (They/Them)  stevie.pederson@thekids.org.au">

<title>High Resolution Technologies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="high_res_technologies_files/libs/clipboard/clipboard.min.js"></script>
<script src="high_res_technologies_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="high_res_technologies_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="high_res_technologies_files/libs/quarto-html/popper.min.js"></script>
<script src="high_res_technologies_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="high_res_technologies_files/libs/quarto-html/anchor.min.js"></script>
<link href="high_res_technologies_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="high_res_technologies_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="high_res_technologies_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="high_res_technologies_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="high_res_technologies_files/libs/bootstrap/bootstrap-1e1b6d7d3018d0281420745e134191b0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
</head><body class="quarto-light"><div id="logo-tki" style="position: fixed; z-index: 1000;">
  <img src="https://www.thekids.org.au/Static/Theme/images/TheKids-RGB_Logo_Colour-Pattern.svg" style="height: 80px;">
</div>
<div id="logo-bodl" style="position: fixed; z-index: 1000;">
  <img src="assets/bodl_logo_white_background.jpg" style="height: 80px;">
</div>
<div id="logo-uoa" style="z-index: 1000;">
  <img src="assets/UoA_logo_col_vert.png" style="height: 80px;">
</div>


<script>
function positionLogos() {
  const tkiLogo = document.getElementById('logo-tki');
  const uoaLogo = document.getElementById('logo-uoa');
  const bodlLogo = document.getElementById('logo-bodl');

  // Check if this is RevealJS
  const isRevealJS = document.body.classList.contains('reveal') ||
                     document.querySelector('.reveal') !== null ||
                     typeof Reveal !== 'undefined';

  if (isRevealJS) {
    // RevealJS - both logos at bottom
    tkiLogo.style.bottom = '10px';
    tkiLogo.style.right = '340px';
    tkiLogo.style.top = 'auto';
    tkiLogo.style.display = 'block';

    bodlLogo.style.bottom = '10px';
    bodlLogo.style.right = '160px';
    bodlLogo.style.top = 'auto';
    bodlLogo.style.display = 'block';

    uoaLogo.style.bottom = '10px';
    uoaLogo.style.right = '40px';
    uoaLogo.style.top = 'auto';
    uoaLogo.style.display = 'block';
    uoaLogo.style.position = 'fixed';
  } else {
    // Flat HTML - only right logo at top
    tkiLogo.style.display = 'none';
    bodlLogo.style.display = 'none';

    uoaLogo.style.top = '30px';
    uoaLogo.style.left = '60%';
    uoaLogo.style.bottom = 'auto';
    uoaLogo.style.position = 'absolute';
    uoaLogo.style.display = 'block';
  }
}

// Run positioning
document.addEventListener('DOMContentLoaded', positionLogos);
setTimeout(positionLogos, 100);
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="assets/custom.scss">




<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#acknowledgement-of-country" id="toc-acknowledgement-of-country" class="nav-link active" data-scroll-target="#acknowledgement-of-country"><span class="text-red">Acknowledgement Of Country</span></a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#high-resolution-technologies" id="toc-high-resolution-technologies" class="nav-link" data-scroll-target="#high-resolution-technologies">High Resolution Technologies</a></li>
  </ul></li>
  <li><a href="#single-cell-rna-seq" id="toc-single-cell-rna-seq" class="nav-link" data-scroll-target="#single-cell-rna-seq">Single Cell RNA-Seq</a>
  <ul class="collapse">
  <li><a href="#single-cell-rna-seq-1" id="toc-single-cell-rna-seq-1" class="nav-link" data-scroll-target="#single-cell-rna-seq-1">Single Cell RNA-Seq</a></li>
  <li><a href="#droplet-based-scrna" id="toc-droplet-based-scrna" class="nav-link" data-scroll-target="#droplet-based-scrna">Droplet-Based scRNA</a></li>
  <li><a href="#split-seq" id="toc-split-seq" class="nav-link" data-scroll-target="#split-seq">SPLIT-Seq</a></li>
  <li><a href="#comparison-of-select-technologies" id="toc-comparison-of-select-technologies" class="nav-link" data-scroll-target="#comparison-of-select-technologies">Comparison of Select Technologies</a></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing">Data Processing</a></li>
  <li><a href="#filtering-stages" id="toc-filtering-stages" class="nav-link" data-scroll-target="#filtering-stages">Filtering Stages</a></li>
  <li><a href="#normalisation" id="toc-normalisation" class="nav-link" data-scroll-target="#normalisation">Normalisation</a></li>
  <li><a href="#identifying-cell-types" id="toc-identifying-cell-types" class="nav-link" data-scroll-target="#identifying-cell-types">Identifying Cell Types</a></li>
  <li><a href="#principal-component-analysis" id="toc-principal-component-analysis" class="nav-link" data-scroll-target="#principal-component-analysis">Principal Component Analysis</a></li>
  <li><a href="#clustering-of-cells" id="toc-clustering-of-cells" class="nav-link" data-scroll-target="#clustering-of-cells">Clustering of Cells</a></li>
  <li><a href="#marker-detection" id="toc-marker-detection" class="nav-link" data-scroll-target="#marker-detection">Marker Detection</a></li>
  <li><a href="#cluster-annotation" id="toc-cluster-annotation" class="nav-link" data-scroll-target="#cluster-annotation">Cluster Annotation</a></li>
  </ul></li>
  <li><a href="#spatial-transcriptomics" id="toc-spatial-transcriptomics" class="nav-link" data-scroll-target="#spatial-transcriptomics">Spatial Transcriptomics</a>
  <ul class="collapse">
  <li><a href="#spatial-transcriptomics-1" id="toc-spatial-transcriptomics-1" class="nav-link" data-scroll-target="#spatial-transcriptomics-1">Spatial Transcriptomics</a></li>
  <li><a href="#early-spatial-transcriptomics" id="toc-early-spatial-transcriptomics" class="nav-link" data-scroll-target="#early-spatial-transcriptomics">Early Spatial Transcriptomics</a></li>
  <li><a href="#approaching-single-cell-resolution" id="toc-approaching-single-cell-resolution" class="nav-link" data-scroll-target="#approaching-single-cell-resolution">Approaching Single Cell Resolution</a></li>
  <li><a href="#beyond-sequencing" id="toc-beyond-sequencing" class="nav-link" data-scroll-target="#beyond-sequencing">Beyond Sequencing</a></li>
  <li><a href="#examples-of-10x-xenium-spatial-transcriptomics" id="toc-examples-of-10x-xenium-spatial-transcriptomics" class="nav-link" data-scroll-target="#examples-of-10x-xenium-spatial-transcriptomics">Examples of 10X Xenium Spatial Transcriptomics</a></li>
  <li><a href="#additional-reading" id="toc-additional-reading" class="nav-link" data-scroll-target="#additional-reading">Additional Reading</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"></a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="high_res_technologies-slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li><li><a href="high_res_technologies.pdf"><i class="bi bi-file-pdf"></i>Beamer</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">High Resolution Technologies</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Dr Stevie Pederson (They/Them) <br>stevie.pederson@thekids.org.au </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            </p><div class="line-block">Black Ochre Data Labs<br>
            The Kids Research Institute Australia</div>
          <p></p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="acknowledgement-of-country" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgement-of-country"><span class="text-red">Acknowledgement Of Country</span></h2>
<div class="text-red">
<p>I’d like to acknowledge the Kaurna people as the traditional owners and custodians of the land we know today as the Adelaide Plains, where I live &amp; work.</p>
<p>I also acknowledge the deep feelings of attachment and relationship of the Kaurna people to their place.</p>
<p>I pay my respects to the cultural authority of Aboriginal and Torres Strait Islander peoples from other areas of Australia, and pay my respects to Elders past, present and emerging, and acknowledge any Aboriginal Australians who may be with us today</p>
</div>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<section id="high-resolution-technologies" class="level2">
<h2 class="anchored" data-anchor-id="high-resolution-technologies">High Resolution Technologies</h2>
<ul>
<li>Microarray and early RNA-Seq analysis used ‘bulk’ tissues</li>
<li>Very hard to obtain pure cell-types in most samples
<ul>
<li>T cells sorted by FACS still hetergeneous</li>
<li>Cancer biopsises are heterogeneous</li>
<li>Immortalised cell-lines (HeLa, HEK293 etc.) differentiate into multiple cell types</li>
</ul></li>
</ul>
<div class="incremental">
<ul class="incremental">
<li>Single-Cell RNA-Seq (scRNA-Seq) <span class="math inline">\(\implies\)</span> Identify cell-types within a sample</li>
<li>Spatial Transcriptomics <span class="math inline">\(\implies\)</span> Identify cell-types on a slide by location
<ul class="incremental">
<li>Doesn’t always utilise sequencing</li>
</ul></li>
</ul>
</div>
</section>
<section id="high-resolution-technologies-1" class="level2 slide-only unlisted">
<h2 class="slide-only unlisted anchored" data-anchor-id="high-resolution-technologies-1">High Resolution Technologies</h2>
<ul>
<li>Quite a different set of questions to bulk tissue</li>
</ul>
<div class="incremental">
<ul class="incremental">
<li>Is differential expression large in a subset of cells?
<ul class="incremental">
<li>Or small in all cells?</li>
</ul></li>
<li>How do cells travel through differentiation trajectories?</li>
<li>Which cells are communicating with which other cells?</li>
<li>Which cells are co-localised within tissue samples?
<ul class="incremental">
<li>And where are the transcripts within a cell?</li>
</ul></li>
</ul>
</div>
</section>
</section>
<section id="single-cell-rna-seq" class="level1">
<h1>Single Cell RNA-Seq</h1>
<section id="single-cell-rna-seq-1" class="level2">
<h2 class="anchored" data-anchor-id="single-cell-rna-seq-1">Single Cell RNA-Seq</h2>
<div class="notes">
<ul>
<li>The key challenge has been how to isolate individual cells then how to obtain enough material to sequence and assign all reads to the correct cell</li>
<li>The technology needs to address throughput in terms of sequencing depth, but also in cell numbers
<ul>
<li>Growth in capacity to increase cell numbers has been roughly exponential</li>
<li>Data can get very large</li>
</ul></li>
<li>High failure rate when capturing RNA
<ul>
<li>Zero reads for a gene within a cell is no longer a reliable marker of no expression</li>
</ul></li>
</ul>
</div>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="assets/scRNATimeline.jpg" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Figure from <span class="citation" data-cites="Svensson2018-rs">Svensson, Vento-Tormo, and Teichmann (<a href="#ref-Svensson2018-rs" role="doc-biblioref">2018</a>)</span></figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="droplet-based-scrna" class="level2">
<h2 class="anchored" data-anchor-id="droplet-based-scrna">Droplet-Based scRNA</h2>
<div class="notes">
<ul>
<li>Have already dissociated cells</li>
</ul>
</div>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="assets/chromium-partitioning-library-prep.png" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="fragment">
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="assets/chromium-technology-gel-bead.png" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:100.0%"></p>
</figure>
</div>
</div><div class="column">
<ul>
<li>GEM: Gel bead in EMulsion</li>
<li>Primers can capture 3’, 5’ or targeted sequences</li>
<li>Figures from www.10xgenomics.com</li>
</ul>
</div>
</div>
</div>
</section>
<section id="droplet-based-scrna-1" class="level2 slide-only unlisted">
<h2 class="slide-only unlisted anchored" data-anchor-id="droplet-based-scrna-1">Droplet-Based scRNA</h2>
<p><img src="https://cdn.10xgenomics.com/image/upload/f_auto,q_auto,w_900,dpr_2.0/v1709753672/blog/GEM-X%20Launch%20blog/vertical_flipped_GEM96_H1975_high_4_S0001.gif" class="img-fluid"></p>
<div class="fragment">
<div class="columns">
<div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/gem_x_coverage.png" class="img-fluid figure-img"></p>
<figcaption>www.10xgenomics.com</figcaption>
</figure>
</div>
</div><div class="column" style="width:60%;">
<ul>
<li>UMIs represent individual RNA molecules</li>
<li>Now capturing ~14,000 transcripts/cell</li>
</ul>
</div>
</div>
</div>
</section>
<section id="split-seq" class="level2">
<h2 class="anchored" data-anchor-id="split-seq">SPLIT-Seq</h2>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/SPLIT_seq.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>Taken from <span class="citation" data-cites="Rosenberg2018-wl">Rosenberg et al. (<a href="#ref-Rosenberg2018-wl" role="doc-biblioref">2018</a>)</span></figcaption>
</figure>
</div>
</div><div class="column">
<p>SPLIT-Seq is an alternative, plate based scRNA method</p>
<ul>
<li>Cells are split into pools and fixed</li>
<li>One barcode/pool</li>
<li>Multiple rounds of pooling and barcoding</li>
<li>All amplification is <em>in situ</em></li>
</ul>
</div>
</div>
<!-- ## CITE-Seq -->
<!-- - Cellular Indexing of Transcriptomes and Epitopes by sequencing (CITE-Seq) [@Stoeckius2017-od] -->
<!--     + Designed for Droplet-based methods -->
<!-- - Extends scRNA using labelled antibodies for cell-surface proteins -->
<!-- - Antibodies labelled with oligo tags -->
<!-- - Oligos are amplified along with RNA after cell lysis -->
</section>
<section id="comparison-of-select-technologies" class="level2">
<h2 class="anchored" data-anchor-id="comparison-of-select-technologies">Comparison of Select Technologies</h2>
<table class="caption-top table">
<caption>Data sourced from <span class="citation" data-cites="Haque2017-ae">Haque et al. (<a href="#ref-Haque2017-ae" role="doc-biblioref">2017</a>)</span></caption>
<colgroup>
<col style="width: 15%">
<col style="width: 25%">
<col style="width: 18%">
<col style="width: 22%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Protocol</strong></th>
<th style="text-align: left;"><strong>C1 (SMART-Seq)</strong></th>
<th style="text-align: left;"><strong>SMART-Seq2</strong></th>
<th style="text-align: left;"><strong>10X Chromium</strong></th>
<th style="text-align: left;"><strong>SPLIT-Seq</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><em>Platform</em></td>
<td style="text-align: left;">Microfluidics</td>
<td style="text-align: left;">Plate-based</td>
<td style="text-align: left;">Droplet</td>
<td style="text-align: left;">Plate-based</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Transcript</em></td>
<td style="text-align: left;">Full-length</td>
<td style="text-align: left;">Full-length</td>
<td style="text-align: left;">3’-end</td>
<td style="text-align: left;">3’-end</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>Cells</em></td>
<td style="text-align: left;">10<sup>2</sup> − 10<sup>3</sup></td>
<td style="text-align: left;">10<sup>2</sup> − 10<sup>3</sup></td>
<td style="text-align: left;">10<sup>3</sup> − 10<sup>4</sup></td>
<td style="text-align: left;">10<sup>3</sup> − 10<sup>5</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Reads/Cell</em></td>
<td style="text-align: left;">10<sup>6</sup></td>
<td style="text-align: left;">10<sup>6</sup></td>
<td style="text-align: left;">10<sup>4</sup> − 10<sup>5</sup></td>
<td style="text-align: left;">10<sup>4</sup></td>
</tr>
</tbody>
</table>
</section>
<section id="data-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-processing">Data Processing</h2>
<ul>
<li>Most pre-processing for 10X data is performed using CellRanger</li>
<li>Handles demultiplexing, alignment (STAR) and quantification (using UMIs)
<ul>
<li>Full-length transcript methods can utilise kallisto/salmon</li>
</ul></li>
<li>We end up with a feature-barcode matrix
<ul>
<li>A barcode represents an individual cell (or a set of reactions)</li>
<li>A feature is commonly thought of as a gene in scRNA-Seq</li>
</ul></li>
<li>Similar to counts from bulk RNA-Seq but with many more columns (cells)
<ul>
<li>Also many more zero counts for genes</li>
</ul></li>
</ul>
</section>
<section id="filtering-stages" class="level2">
<h2 class="anchored" data-anchor-id="filtering-stages">Filtering Stages</h2>
<ul>
<li>The aim is to keep the <em>high quality cells</em> and discard the dubious cells, such as:
<ol type="1">
<li>Low/High read numbers (library sizes)</li>
<li>Low feature/gene numbers</li>
<li>High proportions of mitochondrial RNA =⇒ cells broken prior to lysis</li>
<li>Doublets (i.e.&nbsp;two cells instead of a single cell)</li>
</ol></li>
</ul>
<div class="fragment">
<ul>
<li>Also filter for genes considered as detectable (Average Counts &gt; 1)
<ul>
<li>Some zero counts are from unexpressed genes</li>
<li>Others are “dropouts” <span class="math inline">\(\rightarrow\)</span> RNA capture efficiency between 10-40%</li>
</ul></li>
</ul>
</div>
</section>
<section id="normalisation" class="level2">
<h2 class="anchored" data-anchor-id="normalisation">Normalisation</h2>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="assets/12864_2024_10364_Fig2_HTML.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption>Image from <span class="citation" data-cites="Cuevas-Diaz-Duran2024-zc">Cuevas-Diaz Duran, Wei, and Wu (<a href="#ref-Cuevas-Diaz-Duran2024-zc" role="doc-biblioref">2024</a>)</span></figcaption>
</figure>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>Bulk-RNA normalisation methods no longer applicable
<ul>
<li>Does each cell (or cell-type) have the same starting amount of RNA?</li>
</ul></li>
<li>Normalisation strategies may be platform dependent
<ul>
<li>Gene length impacts full-length methods but not droplet-based (3’ or 5’)</li>
</ul></li>
<li>Should missing values be imputed?</li>
</ul>
</div>
</section>
<section id="identifying-cell-types" class="level2">
<h2 class="anchored" data-anchor-id="identifying-cell-types">Identifying Cell Types</h2>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/SC_umap.png" class="img-fluid figure-img"></p>
<figcaption>Image courtesy of the Harvard Chan Bioinformatics Core</figcaption>
</figure>
</div>
</div><div class="column">
<ul>
<li>A key aim is to identify different cell types in our sample</li>
<li>How many cell types are there really?</li>
<li>How similar are cell types?</li>
<li>What genes drive the differences <br> <span class="math inline">\(\rightarrow\)</span> Differential Expression</li>
</ul>
<div class="incremental">
<ol class="incremental" type="1">
<li>Dimensional Reduction</li>
<li>Clustering Cells</li>
</ol>
</div>
</div>
</div>
</section>
<section id="principal-component-analysis" class="level2">
<h2 class="anchored" data-anchor-id="principal-component-analysis">Principal Component Analysis</h2>
<ul>
<li>scRNA (+ bulk RNA) are high dimensional datasets
<ul>
<li>e.g.&nbsp;1,000 cells <span class="math inline">\(\times\)</span> 15,000 genes</li>
</ul></li>
<li>How do we see how similar cells are to each other?
<ul>
<li>Is there a way to summarise distances between cells?</li>
<li>Can we visualise in 2-dimensions?</li>
</ul></li>
</ul>
<div class="incremental">
<ul class="incremental">
<li>Principal Component Analysis (PCA) identifies direction of maximum variance
<ul class="incremental">
<li>Known as PC1</li>
</ul></li>
<li>The we find the next most variable (orthogonal) direction <span class="math inline">\(\implies\)</span> PC2</li>
<li>Data is rotated around PC1, then PC2 etc</li>
<li>Comparing PC1 vs PC2, PC2 vs PC3 etc allows 2D (or 3D) visualisation</li>
</ul>
</div>
</section>
<section id="principal-component-analysis-1" class="level2 slide-only unlisted">
<h2 class="slide-only unlisted anchored" data-anchor-id="principal-component-analysis-1">Principal Component Analysis</h2>
<div class="columns">
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/original_pca_data.png" class="img-fluid figure-img"></p>
<figcaption>Some 2D data points</figcaption>
</figure>
</div>
</div><div class="column" style="width:30%;">
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/PCA_original.png" class="img-fluid figure-img"></p>
<figcaption>Find the direction of max variance</figcaption>
</figure>
</div>
</div>
</div><div class="column" style="width:40%;">
<p><br></p>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/PCA_transformed2.png" class="img-fluid figure-img"></p>
<figcaption>Each point now has a ‘rotated’ value</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>The main directions of variability are hopefully related to the biology</li>
<li>Rotations along PC1 vs PC2 should show separation by biology of interest</li>
</ul>
<p><span style="font-size:60%">Figures taken from https://statisticsbyjim.com/basics/principal-component-analysis/</span></p>
</div>
</section>
<section id="clustering-of-cells" class="level2">
<h2 class="anchored" data-anchor-id="clustering-of-cells">Clustering of Cells</h2>
<div class="columns">
<div class="column" style="width:45%;">
<ul>
<li>To form clusters <span class="math inline">\(\implies\)</span> use top principal components</li>
<li>Often use k-nearest-neighbour (kNN) graph methods to form clusters</li>
<li>Methods like UMAP highlight clusters during visualisation</li>
</ul>
</div><div class="column" style="width:55%;">
<p><img src="assets/SC_umap.png" class="img-fluid"></p>
</div>
</div>
<div class="fragment">
<ul>
<li>Huge number of possible parameters <span class="math inline">\(\implies\)</span> subjective approach to data</li>
</ul>
</div>
</section>
<section id="marker-detection" class="level2">
<h2 class="anchored" data-anchor-id="marker-detection">Marker Detection</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p><img src="assets/FindAllMarkers-4.png" class="img-fluid"></p>
</div><div class="column" style="width:45%;">
<p><img src="assets/FindAllMarkers-10.png" class="img-fluid"></p>
</div>
</div>
<ul>
<li>Find genes unique to a given cluster or shared across multiple clusters</li>
</ul>
<p><span style="font-size:60%">Figures taken from https://ucdavis-bioinformatics-training.github.io/2023-June-Single-Cell-RNA-Seq-Analysis</span></p>
</section>
<section id="cluster-annotation" class="level2">
<h2 class="anchored" data-anchor-id="cluster-annotation">Cluster Annotation</h2>
<div class="columns">
<div class="column" style="width:55%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/umap_labeled.png" class="img-fluid figure-img"></p>
<figcaption>Image courtesy of the Harvard Chan Bioinformatics Core</figcaption>
</figure>
</div>
</div><div class="column" style="width:45%;">
<ul>
<li>Use our expert knowledge of known marker genes to annotate clusters</li>
<li>CITE-Seq uses cell-surface antibodies to aid this step</li>
<li>Can drill deeply into cell-type differences &amp; communication
<ul>
<li>Complementary receptor-ligand expression</li>
</ul></li>
</ul>
</div>
</div>
</section>
</section>
<section id="spatial-transcriptomics" class="level1">
<h1>Spatial Transcriptomics</h1>
<section id="spatial-transcriptomics-1" class="level2">
<h2 class="anchored" data-anchor-id="spatial-transcriptomics-1">Spatial Transcriptomics</h2>
<ul>
<li>Even single cell RNA dissociates cells from position with tissues</li>
<li>Cells function within highly structured tissue environments
<ul>
<li>Cells are likely to have different communication dynamics based on location</li>
</ul></li>
<li><em>Spatial transcriptomics</em> attempts to resolve this limitation</li>
</ul>
</section>
<section id="early-spatial-transcriptomics" class="level2">
<h2 class="anchored" data-anchor-id="early-spatial-transcriptomics">Early Spatial Transcriptomics</h2>
<ul>
<li>First appeared using barcoded primers with fixed location <span class="citation" data-cites="Stahl2016-bx">(<a href="#ref-Stahl2016-bx" role="doc-biblioref">Ståhl et al. 2016</a>)</span>
<ul>
<li>~100 <span class="math inline">\(\mu\)</span>m resolution</li>
</ul></li>
<li>Tissue affixed to prepared slide:
<ul>
<li>Stained &amp; Visualised</li>
<li>Made Permeable</li>
<li>RT-PCR <span class="math inline">\(\implies\)</span> cDNA</li>
<li>Tissue removed enzymatically</li>
<li>Barcoded cDNA <span class="math inline">\(\implies\)</span> sequencing</li>
</ul></li>
</ul>
</section>
<section id="approaching-single-cell-resolution" class="level2">
<h2 class="anchored" data-anchor-id="approaching-single-cell-resolution">Approaching Single Cell Resolution</h2>
<ul>
<li>10X Visium now down to 100 <span class="math inline">\(\mu\)</span>m resolution</li>
<li><em>Slide-seq</em> <span class="citation" data-cites="Stickels2021-zf">(<a href="#ref-Stickels2021-zf" role="doc-biblioref">Stickels et al. 2021</a>)</span>: Barcoded beads <span class="math inline">\(\rightarrow\)</span> ~10<span class="math inline">\(\mu\)</span>m resolution
<ul>
<li>Approaching single cell resolution</li>
<li>Deconvolution of beads single cell</li>
</ul></li>
<li>Stereo-Seq <span class="citation" data-cites="Chen2022-rn">(<a href="#ref-Chen2022-rn" role="doc-biblioref">A. Chen et al. 2022</a>)</span>: etched grid on slide <span class="math inline">\(\implies\)</span> resolution of ~200nm</li>
<li>Seq-Scope <span class="citation" data-cites="Cho2021-og">(<a href="#ref-Cho2021-og" role="doc-biblioref">Cho et al. 2021</a>)</span>:<br> Tissue placed directly on modified Illumina flow-cell <span class="math inline">\(\implies\)</span> resolution ~500nm</li>
</ul>
</section>
<section id="beyond-sequencing" class="level2">
<h2 class="anchored" data-anchor-id="beyond-sequencing">Beyond Sequencing</h2>
<ul>
<li>Barcoded probes via Fluorescence In Situ Hybridisation enable a sequencing-free perspective</li>
<li>Staining technologies used to identify cell boundaries, nucelei etc</li>
<li>MERFISH: multiplexed error-robust FISH <span class="citation" data-cites="Chen2015-qa">(<a href="#ref-Chen2015-qa" role="doc-biblioref">K. H. Chen et al. 2015</a>)</span>
<ul>
<li>Sequence specific barcodes able to detect ~10,000 transcripts</li>
<li>Directly count specific transcripts</li>
<li>Location within cell also identified</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>Extremely rapid technological development (also $$$)</li>
<li>Methods often lag technology somewhat</li>
</ul>
</div>
</section>
<section id="examples-of-10x-xenium-spatial-transcriptomics" class="level2">
<h2 class="anchored" data-anchor-id="examples-of-10x-xenium-spatial-transcriptomics">Examples of 10X Xenium Spatial Transcriptomics</h2>
<div class="notes">
<ul>
<li>Uses a pre-design panel of probes to detect genes</li>
<li>Padlock-based, rolling circle amplification <span class="math inline">\(\implies\)</span> fluorescence</li>
</ul>
</div>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="assets/xenium_cd4.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption>Taken from https://xenium.10xgenomics.com. Highlighting CD4 in human kidney</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="examples-of-10x-xenium-spatial-transcriptomics-1" class="level2 slide-only unlisted">
<h2 class="slide-only unlisted anchored" data-anchor-id="examples-of-10x-xenium-spatial-transcriptomics-1">Examples of 10X Xenium Spatial Transcriptomics</h2>
<div class="columns">
<div class="column" style="width:45%;">
<p><img src="assets/UMAP_lumbar.png" class="img-fluid"></p>
</div><div class="column" style="width:45%;">
<p><img src="assets/Spatial_lumbar.png" class="img-fluid"></p>
</div>
</div>
<p><span style="font-size:60%">Images courtesy of Megan Monaghan. PhD Candidate, Comerford Lab. Adelaide University</span></p>
</section>
<section id="additional-reading" class="level2">
<h2 class="anchored" data-anchor-id="additional-reading">Additional Reading</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=FgakZw6K1QQ">StatQuest: Principal Component Analysis (PCA)</a></li>
<li><a href="https://www.youtube.com/watch?v=HVXime0nQeI">StatQuest: K-nearest neighbors, Clearly Explained</a></li>
<li><a href="https://www.youtube.com/watch?v=eN0wFzBA4Sc">StatQuest: UMAP Dimension Reduction, Main Ideas!!!</a></li>
</ul>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<!-- This is where the bibliography gets injected -->
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Chen2022-rn" class="csl-entry" role="listitem">
Chen, Ao, Sha Liao, Mengnan Cheng, Kailong Ma, Liang Wu, Yiwei Lai, Xiaojie Qiu, et al. 2022. <span>“Spatiotemporal Transcriptomic Atlas of Mouse Organogenesis Using <span>DNA</span> Nanoball-Patterned Arrays.”</span> <em>Cell</em> 185 (10): 1777–1792.e21.
</div>
<div id="ref-Chen2015-qa" class="csl-entry" role="listitem">
Chen, Kok Hao, Alistair N Boettiger, Jeffrey R Moffitt, Siyuan Wang, and Xiaowei Zhuang. 2015. <span>“<span>RNA</span> Imaging. Spatially Resolved, Highly Multiplexed <span>RNA</span> Profiling in Single Cells.”</span> <em>Science</em> 348 (6233): aaa6090.
</div>
<div id="ref-Cho2021-og" class="csl-entry" role="listitem">
Cho, Chun-Seok, Jingyue Xi, Yichen Si, Sung-Rye Park, Jer-En Hsu, Myungjin Kim, Goo Jun, Hyun Min Kang, and Jun Hee Lee. 2021. <span>“Microscopic Examination of Spatial Transcriptome Using Seq-Scope.”</span> <em>Cell</em> 184 (13): 3559–3572.e22.
</div>
<div id="ref-Cuevas-Diaz-Duran2024-zc" class="csl-entry" role="listitem">
Cuevas-Diaz Duran, Raquel, Haichao Wei, and Jiaqian Wu. 2024. <span>“Data Normalization for Addressing the Challenges in the Analysis of Single-Cell Transcriptomic Datasets.”</span> <em>BMC Genomics</em> 25 (1): 444.
</div>
<div id="ref-Haque2017-ae" class="csl-entry" role="listitem">
Haque, Ashraful, Jessica Engel, Sarah A Teichmann, and Tapio Lönnberg. 2017. <span>“A Practical Guide to Single-Cell <span>RNA</span>-Sequencing for Biomedical Research and Clinical Applications.”</span> <em>Genome Med.</em> 9 (1): 75.
</div>
<div id="ref-Rosenberg2018-wl" class="csl-entry" role="listitem">
Rosenberg, Alexander B, Charles M Roco, Richard A Muscat, Anna Kuchina, Paul Sample, Zizhen Yao, Lucas T Graybuck, et al. 2018. <span>“Single-Cell Profiling of the Developing Mouse Brain and Spinal Cord with Split-Pool Barcoding.”</span> <em>Science</em> 360 (6385): 176–82.
</div>
<div id="ref-Stahl2016-bx" class="csl-entry" role="listitem">
Ståhl, Patrik L, Fredrik Salmén, Sanja Vickovic, Anna Lundmark, José Fernández Navarro, Jens Magnusson, Stefania Giacomello, et al. 2016. <span>“Visualization and Analysis of Gene Expression in Tissue Sections by Spatial Transcriptomics.”</span> <em>Science</em> 353 (6294): 78–82.
</div>
<div id="ref-Stickels2021-zf" class="csl-entry" role="listitem">
Stickels, Robert R, Evan Murray, Pawan Kumar, Jilong Li, Jamie L Marshall, Daniela J Di Bella, Paola Arlotta, Evan Z Macosko, and Fei Chen. 2021. <span>“Highly Sensitive Spatial Transcriptomics at Near-Cellular Resolution with Slide-<span class="nocase">seqV2</span>.”</span> <em>Nat. Biotechnol.</em> 39 (3): 313–19.
</div>
<div id="ref-Svensson2018-rs" class="csl-entry" role="listitem">
Svensson, Valentine, Roser Vento-Tormo, and Sarah A Teichmann. 2018. <span>“Exponential Scaling of Single-Cell <span>RNA</span>-Seq in the Past Decade.”</span> <em>Nat. Protoc.</em> 13 (4): 599–604.
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>